<div class="admin-container">
  <div class="header">
    <div class="header-content">
      <div (click)="clickEnLogo()" style="cursor: pointer;">
        <h1>Hotel HB C√≥rdoba</h1>
        <p class="tagline">Panel de Administraci√≥n</p>
      </div>
      <div class="header-buttons">
        <button class="btn-reload" (click)="recargarDatos()">üîÑ Recargar</button>
        <button class="btn-reset" (click)="limpiarTodosLosDatos()">üóëÔ∏è Limpiar Bloqueos</button>
        <button class="btn-logout" (click)="logout()">Cerrar Sesi√≥n</button>
      </div>
    </div>
  </div>

  <!-- BOT√ìN SECRETO PARA ELIMINAR TODO -->
  <div class="danger-zone" *ngIf="mostrarBotonEliminar">
    <button class="btn-delete-all" (click)="eliminarTodoFirebase()">
      ‚ö†Ô∏è ELIMINAR TODO DE FIREBASE ‚ö†Ô∏è
    </button>
  </div>

  <!-- PESTA√ëAS DE NAVEGACI√ìN -->
  <div class="tabs-container">
    <button 
      class="tab-button" 
      [class.active]="vistaActual === 'estadisticas'"
      (click)="cambiarVista('estadisticas')">
      üìä Estad√≠sticas Generales
    </button>
    <button 
      class="tab-button" 
      [class.active]="vistaActual === 'detalle'"
      (click)="cambiarVista('detalle')">
      üìã Historial Detallado
    </button>
  </div>

  <!-- INDICADOR DE CARGA -->
  <div class="loading-container" *ngIf="cargando">
    <div class="spinner"></div>
    <p>Cargando datos desde Firebase...</p>
  </div>

  <!-- VISTA DE ESTAD√çSTICAS -->
  <div class="dashboard-content" *ngIf="!cargando && vistaActual === 'estadisticas'">
    <div class="stats-overview">
      <div class="stat-card">
        <div class="stat-number">{{ estadisticas?.totalCancelaciones || 0 }}</div>
        <div class="stat-label">Encuestas de Cancelaci√≥n</div>
      </div>
      <div class="stat-card">
        <div class="stat-number">{{ estadisticas?.totalSeguimientos || 0 }}</div>
        <div class="stat-label">Encuestas de Seguimiento</div>
      </div>
    </div>

    <div class="charts-section" *ngIf="estadisticas?.cancelacion">
      <div class="chart-card">
        <h2>Estad√≠sticas de Cancelaci√≥n</h2>
        
        <div class="stat-item">
          <span class="stat-label-inline">Propuesta se ajust√≥:</span>
          <span class="stat-value">{{ estadisticas.cancelacion.propuestaAjustada }}%</span>
        </div>
        
        <div class="stat-item">
          <span class="stat-label-inline">Atenci√≥n cumpli√≥ expectativas:</span>
          <span class="stat-value">{{ estadisticas.cancelacion.atencionCumplio }}%</span>
        </div>
        
        <div class="stat-item">
          <span class="stat-label-inline">Encontraron alternativa:</span>
          <span class="stat-value">{{ estadisticas.cancelacion.encontroAlternativa }}%</span>
        </div>

        <h3>Motivos Principales</h3>
        <div class="list-items">
          <div class="list-item" *ngFor="let motivo of obtenerClaves(estadisticas.cancelacion.motivosPrincipales)">
            <span class="item-label">{{ motivo }}</span>
            <span class="item-count">{{ estadisticas.cancelacion.motivosPrincipales[motivo] }} respuestas</span>
          </div>
        </div>
      </div>
    </div>

    <div class="charts-section" *ngIf="estadisticas?.seguimiento">
      <div class="chart-card">
        <h2>Estad√≠sticas de Seguimiento</h2>
        
        <div class="stat-item">
          <span class="stat-label-inline">Quieren ajustar propuesta:</span>
          <span class="stat-value">{{ estadisticas.seguimiento.quierenAjuste }}%</span>
        </div>
        
        <div class="stat-item">
          <span class="stat-label-inline">Quieren visita/llamada:</span>
          <span class="stat-value">{{ estadisticas.seguimiento.quierenVisita }}%</span>
        </div>

        <div class="stat-item">
          <span class="stat-label-inline">Quieren contacto en 24h:</span>
          <span class="stat-value">{{ estadisticas.seguimiento.quierenContacto24h }}%</span>
        </div>

        <h3>Aspectos que Detienen</h3>
        <div class="list-items">
          <div class="list-item" *ngFor="let aspecto of obtenerClaves(estadisticas.seguimiento.aspectos)">
            <span class="item-label">{{ aspecto }}</span>
            <span class="item-count">{{ estadisticas.seguimiento.aspectos[aspecto] }} respuestas</span>
          </div>
        </div>

        <h3>Calificaci√≥n de Atenci√≥n</h3>
        <div class="list-items">
          <div class="list-item" *ngFor="let calificacion of obtenerClaves(estadisticas.seguimiento.atencion)">
            <span class="item-label">{{ calificacion }}</span>
            <span class="item-count">{{ estadisticas.seguimiento.atencion[calificacion] }} respuestas</span>
          </div>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="estadisticas?.totalCancelaciones === 0 && estadisticas?.totalSeguimientos === 0">
      <div class="empty-icon">üìä</div>
      <h3>No hay datos todav√≠a</h3>
      <p>Las estad√≠sticas aparecer√°n aqu√≠ cuando los clientes completen las encuestas.</p>
      <button class="btn-reload-empty" (click)="recargarDatos()">üîÑ Recargar datos</button>
    </div>
  </div>

  <!-- VISTA DE HISTORIAL DETALLADO -->
  <div class="dashboard-content" *ngIf="!cargando && vistaActual === 'detalle'">
    <!-- FILTROS -->
    <div class="filtros-container">
      <h3>Filtrar por fecha</h3>
      <div class="filtros-row">
        <select [(ngModel)]="filtroSeleccionado" (change)="aplicarFiltro()" class="filtro-select">
          <option value="todo">Todo el historial</option>
          <option value="hoy">Hoy</option>
          <option value="semana">√öltima semana</option>
          <option value="mes">√öltimo mes</option>
          <option value="personalizado">Rango personalizado</option>
        </select>

        <div *ngIf="filtroSeleccionado === 'personalizado'" class="fecha-inputs">
          <input type="date" [(ngModel)]="fechaInicio" class="fecha-input">
          <span>hasta</span>
          <input type="date" [(ngModel)]="fechaFin" class="fecha-input">
          <button class="btn-aplicar" (click)="aplicarFiltro()">Aplicar</button>
        </div>

        <button class="btn-exportar" (click)="exportarAExcel()">üì• Exportar Excel</button>
      </div>
    </div>

    <!-- TABLA DE CANCELACIONES -->
    <div class="tabla-section" *ngIf="respuestasCancelacion.length > 0">
      <h3>Encuestas de Cancelaci√≥n ({{ respuestasCancelacion.length }})</h3>
      <div class="tabla-responsive">
        <table class="tabla-detalle">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Propuesta Ajustada</th>
              <th>Atenci√≥n</th>
              <th>Alternativa</th>
              <th>Motivo</th>
              <th>Contacto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let resp of respuestasCancelacion">
              <td>{{ formatearFecha(resp.fecha) }}</td>
              <td><span class="badge" [class.badge-si]="resp.propuestaAjustada" [class.badge-no]="!resp.propuestaAjustada">{{ resp.propuestaAjustada ? 'S√≠' : 'No' }}</span></td>
              <td><span class="badge" [class.badge-si]="resp.atencionCumplio" [class.badge-no]="!resp.atencionCumplio">{{ resp.atencionCumplio ? 'S√≠' : 'No' }}</span></td>
              <td><span class="badge" [class.badge-si]="resp.encontroAlternativa" [class.badge-no]="!resp.encontroAlternativa">{{ resp.encontroAlternativa ? 'S√≠' : 'No' }}</span></td>
              <td>{{ resp.motivoPrincipal }}</td>
              <td>
                <div *ngIf="resp.nombreCliente" class="contacto-info">
                  <strong>{{ resp.nombreCliente }}</strong><br>
                  <a *ngIf="resp.telefonoCliente" [href]="'https://wa.me/' + resp.telefonoCliente" target="_blank" class="whatsapp-link">
                    {{ resp.telefonoCliente }}
                  </a>
                </div>
                <span *ngIf="!resp.nombreCliente">-</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- TABLA DE SEGUIMIENTOS -->
    <div class="tabla-section" *ngIf="respuestasSeguimiento.length > 0">
      <h3>Encuestas de Seguimiento ({{ respuestasSeguimiento.length }})</h3>
      <div class="tabla-responsive">
        <table class="tabla-detalle">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Aspecto que Detiene</th>
              <th>Ajustar Propuesta</th>
              <th>Atenci√≥n</th>
              <th>Visita/Llamada</th>
              <th>Contacto 24h</th>
              <th>Contacto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let resp of respuestasSeguimiento">
              <td>{{ formatearFecha(resp.fecha) }}</td>
              <td>{{ resp.aspectoDetiene }}</td>
              <td><span class="badge" [class.badge-si]="resp.ajustarPropuesta" [class.badge-no]="!resp.ajustarPropuesta">{{ resp.ajustarPropuesta ? 'S√≠' : 'No' }}</span></td>
              <td><span class="badge badge-atencion">{{ resp.atencionEquipo }}</span></td>
              <td><span class="badge" [class.badge-si]="resp.visitaLlamada" [class.badge-no]="!resp.visitaLlamada">{{ resp.visitaLlamada ? 'S√≠' : 'No' }}</span></td>
              <td><span class="badge" [class.badge-si]="resp.contacto24h" [class.badge-no]="!resp.contacto24h">{{ resp.contacto24h ? 'S√≠' : 'No' }}</span></td>
              <td>
                <div *ngIf="resp.nombreCliente" class="contacto-info">
                  <strong>{{ resp.nombreCliente }}</strong><br>
                  <a *ngIf="resp.telefonoCliente" [href]="'https://wa.me/' + resp.telefonoCliente" target="_blank" class="whatsapp-link">
                    {{ resp.telefonoCliente }}
                  </a>
                </div>
                <span *ngIf="!resp.nombreCliente">-</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- SIN RESULTADOS -->
    <div class="empty-state" *ngIf="respuestasCancelacion.length === 0 && respuestasSeguimiento.length === 0">
      <div class="empty-icon">üìÖ</div>
      <h3>No hay respuestas en este per√≠odo</h3>
      <p>Intente seleccionar un rango de fechas diferente</p>
    </div>
  </div>
</div>